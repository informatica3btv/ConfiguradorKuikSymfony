{% extends 'layout.html.twig' %}

{% block page_title %}Tipo de columnas{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <style>
    body{
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#f6f9fc;
      color:#0b1220;
    }
    .config-form{
      max-width: 980px;
      margin: 28px auto 60px;
      padding: 10px 10px 30px;
      font-size: 16px;
    }
    .option-row{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:12px;
    }
    .option-card{
      padding:18px;
      border-radius:18px;
      border:1px solid rgba(15,23,42,.12);
      background:#fff;
      cursor:pointer;
      transition:.15s;
      appearance:none;
      -webkit-appearance:none;
      text-align:center;
    }
    .option-card:hover{
      transform:translateY(-1px);
      box-shadow: 0 6px 14px rgba(2,20,60,.10);
    }
    .option-card.selected{
      border-color:#1187e6;
      box-shadow:0 0 0 4px rgba(17,135,230,.15);
    }
    .option-title{
      font-weight:800;
      font-size:16px;
    }
    .option-sub{
      font-size:14px;
      color:#6b7280;
    }
    .primary-btn{
      padding:14px 24px;
      border-radius:999px;
      border:0;
      background:linear-gradient(135deg,#0b76d8,#1187e6);
      color:#fff;
      font-weight:800;
      cursor:pointer;
      box-shadow:0 10px 20px rgba(17,135,230,.25);
      transition:.15s;
    }
    .primary-btn:hover{ transform:translateY(-1px); }

    .warn{ color:#c0392b; font-weight:800; }
  </style>
{% endblock %}

{% block content %}
<form method="get"
      action=""
      id="typeForm"
      class="config-form"
      data-home-url="{{ path('configuration_home_instalacion') }}"
      data-professional-url="{{ path('configuration_columns') }}">

  <input type="hidden" name="config_id" id="config_id" value="{{ configuration.id }}">
  <input type="hidden" name="project_id" id="project_id" value="{{ project.id }}">
  <input type="hidden" name="type" id="type" value="">

  <div style="margin:16px 0;">
    <h3 style="margin-bottom: 8px; font-size:24px;">Selecciona tipo de configuracion</h3>

    <div class="option-row" data-group="type" style="grid-template-columns:repeat(3,1fr);">
      {% for type in types %}
        <button type="button" class="option-card" data-value="{{ type.value }}">
          <div class="option-title">{{ type.name }}</div>
        </button>
      {% endfor %}
    </div>
  </div>

  <div style="margin-top:18px; display:flex; gap:10px; align-items:center;">
    <button type="submit" class="primary-btn">Siguiente</button>
    <div id="typeError" class="warn"></div>
  </div>
</form>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('typeForm');
  const hidden = document.getElementById('type');
  const err = document.getElementById('typeError');

  const configId = document.getElementById('config_id')?.value || '';
  const projectId = document.getElementById('project_id')?.value || '';

  const homeUrl = form.dataset.homeUrl;
  const professionalUrl = form.dataset.professionalUrl;

  // Selección de tarjeta
  document.querySelectorAll('.option-row[data-group="type"] .option-card').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.option-row[data-group="type"] .option-card')
        .forEach(b => b.classList.remove('selected'));

      btn.classList.add('selected');
      hidden.value = btn.dataset.value || '';
      if (err) err.textContent = '';
    });
  });

  // Submit -> redirección controlada
  form.addEventListener('submit', (e) => {
    e.preventDefault(); // ✅ clave: evita recarga a la misma URL

    const v = (hidden.value || '').trim();
    if (!v) {
      if (err) err.textContent = 'Selecciona un tipo de columna para continuar.';
      return;
    }

    let target = '';
    if (v === 'home') target = homeUrl;
    else if (v === 'professional') target = professionalUrl;
    else target = professionalUrl; // fallback por si hay más tipos

    const params = new URLSearchParams();
    if (configId) params.set('config_id', configId);
    if (projectId) params.set('project_id', projectId);
    params.set('type', v);

    window.location.href = target + '?' + params.toString();
  });
});
</script>
{% endblock %}
