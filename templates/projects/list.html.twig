{% extends 'layout.html.twig' %}
{% block page_title %}Proyectos{% endblock %}

{% block stylesheets %}
{{ parent() }}
<style>
  :root{
    --bg:#f6f9fc;
    --ink:#0b1220;
    --muted:#6b7280;
    --line: rgba(15, 23, 42, .12);
    --shadow: 0 10px 25px rgba(2,20,60,.08);
    --shadow-sm: 0 6px 14px rgba(2,20,60,.08);

    --blue-900:#003b73;
    --blue-600:#0b76d8;
    --blue-500:#1187e6;
  }

  .wrap{
    max-width: 1200px;
    margin: 26px auto 60px;
    padding: 0 14px;
  }

  .page-head{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:16px;
    flex-wrap:wrap;
  }

  .title{
    font-size:34px;
    font-weight:900;
    margin:0;
    letter-spacing:-0.02em;
  }

  .subtitle{
    margin-top:6px;
    color: var(--muted);
    font-size:15px;
  }

  .btn-primary{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding:12px 16px;
    border-radius:14px;
    background: linear-gradient(135deg, var(--blue-600), var(--blue-500));
    color:#fff;
    text-decoration:none;
    font-weight:900;
    border:0;
    box-shadow: 0 10px 20px rgba(17,135,230,.18);
    white-space:nowrap;
  }
  .btn-primary:hover{ transform: translateY(-1px); }
  .btn-primary .plus{
    width:28px; height:28px;
    border-radius:10px;
    background: rgba(255,255,255,.18);
    display:inline-flex;
    align-items:center;
    justify-content:center;
    font-size:18px;
    line-height:1;
  }

  .search-row{
    margin-top:18px;
    display:flex;
    gap:12px;
    align-items:center;
    flex-wrap:wrap;
  }

  .search{
    flex: 1 1 520px;
    min-width: 280px;
    position:relative;
  }

  .search input{
    width:100%;
    padding:12px 14px 12px 44px;
    border-radius:14px;
    border:1px solid var(--line);
    background:#fff;
    outline:none;
    font-size:14px;
  }
  .search input:focus{
    box-shadow:0 0 0 4px rgba(17,135,230,.12);
    border-color: rgba(17,135,230,.35);
  }

  .search .icon{
    position:absolute;
    left:14px; top:50%;
    transform: translateY(-50%);
    color: var(--muted);
    font-size:16px;
    pointer-events:none;
  }

  .grid{
    margin-top:18px;
    display:grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap:18px;
  }
  @media (max-width: 900px){
    .grid{ grid-template-columns: 1fr; }
  }

  .p-card{
    background:#fff;
    border:1px solid var(--line);
    border-radius:18px;
    padding:18px;
    box-shadow: var(--shadow-sm);
  }

  .p-top{
    display:flex;
    justify-content:space-between;
    gap:12px;
    align-items:flex-start;
  }

  .p-name{
    margin:0;
    font-size:20px;
    font-weight:900;
  }

  .c-name{
    margin:0;
    padding: 5px 10px;
    font-size:18px;
    font-weight:900;
  }

  .pill{
    font-size:12px;
    font-weight:900;
    color: var(--blue-900);
    background: rgba(17,135,230,.10);
    border:1px solid rgba(17,135,230,.12);
    padding:5px 10px;
    border-radius:999px;
    white-space:nowrap;
  }

  .pill-status{
    font-size:12px;
    font-weight:900;
    color: rgb(30, 102, 2);
    background: rgba(73, 253, 2, 0.21);
    border:1px solid  rgba(73, 253, 2, 0.21);
    padding:5px 10px;
    border-radius:999px;
    white-space:nowrap;
  }

  .p-meta{
    margin-top:10px;
    display:grid;
    gap:10px;
  }

  .meta-row{
    display:flex;
    gap:10px;
    align-items:center;
    color:#334155;
    font-size:14px;
  }

  .micon{
    width:18px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    color: var(--muted);
  }

  .divider{
    margin:14px 0;
    border-top:1px solid rgba(15,23,42,.08);
  }

  .btn-ghost{
    width:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    padding:12px 14px;
    border-radius:14px;
    border:1px solid rgba(15,23,42,.12);
    background:#fff;
    font-weight:900;
    text-decoration:none;
    color: var(--ink);
  }
  .btn-ghost:hover{
    box-shadow: var(--shadow-sm);
    transform: translateY(-1px);
  }

  .empty{
    margin-top:18px;
    background:#fff;
    border:1px solid var(--line);
    border-radius:18px;
    padding:18px;
  }
  .empty p{ margin:0 0 12px; color: var(--muted); }

  .btn-create{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding:10px 14px;
    border-radius:14px;
    background: linear-gradient(135deg, var(--blue-600), var(--blue-500));
    color:#fff;
    text-decoration:none;
    font-weight:900;
  }

  /* peque√±o detalle para que ‚Äúparezca‚Äù como en la imagen */
  .wrap *{ box-sizing:border-box; }
</style>
{% endblock %}

{% block content %}
<div class="wrap">

  <div class="page-head">
    <div>
      <h1 class="title">Proyectos</h1>
      <div class="subtitle">Gestiona tus proyectos de taquillas inteligentes</div>
    </div>

    <a class="btn-primary" href="{{ path('configuration_project_new') }}">
      <span class="plus">+</span>
      Nuevo Proyecto
    </a>
  </div>

  <div class="search-row">
    <div class="search">
      <span class="icon">üîç</span>
      <input id="projectSearch" type="text" placeholder="Buscar por nombre, cliente o ciudad..." autocomplete="off">
    </div>
  </div>

  {% if projects is empty %}
    <div class="empty">
      <p>No tienes proyectos todav√≠a.</p>
      <a href="{{ path('configuration_project_new') }}" class="btn-create">Crear primer proyecto</a>
    </div>
  {% else %}
    <div class="grid" id="projectsGrid">
      {% for project in projects %}
        <div class="p-card"
             data-name="{{ project.projectName|lower }}"
             data-client="{{ project.clientName|lower }}"
             data-city="{{ (project.city ?? '')|lower }}">
          <div class="p-top">
            <div>
              <div style="display:flex; gap: 10px;">
                <h3 class="p-name">{{ project.projectName }}</h3>
                {% if project.status == 1 %}
                  <div class="pill-status">Aceptado</div>
                {% endif %}
                
              
              </div>
              <div class="meta-row" style="margin-top:6px;">
                <span class="micon">üë§</span>
                <span class="muted">{{ project.clientName }}</span>
              </div>
            </div>

            {# Si no tienes contador de configs, deja 0 (o ponlo si lo tienes en tu entidad/DTO) #}
            {% set configsCount = project.totalConfigurations|default(0) %}
            <div class="pill">{{ configsCount }} config</div>
          </div>

          <div class="p-meta">
            <div class="meta-row">
              <span class="micon">üìç</span>
              <span class="muted">{{ project.city ?: '‚Äî' }}</span>
            </div>
  
            <div class="meta-row">
              <span class="micon">üìÖ</span>
              <span class="muted">
                {% if project.createdAt is defined and project.createdAt %}
                  {{ project.createdAt|format_datetime('none', 'none', locale='es', pattern='d MMMM y') }}

                {% else %}
                  ‚Äî
                {% endif %}
              </span>
            </div>

            <div class="meta-row" style="margin-top:6px;">
              <span class="micon">üíº</span>
              <span class="muted">{{ project.user.name }}</span>
            </div>
            
          </div>

          <div class="divider"></div>

          <a class="btn-ghost" href="{{ path('project_configurations', { project_id: project.id }) }}">
            Ver proyecto <span aria-hidden="true">‚Üí</span>
          </a>
        </div>
      {% endfor %}
    </div>

    <script>
      // filtro simple (nombre / cliente / ciudad)
      (function(){
        const input = document.getElementById('projectSearch');
        const cards = Array.from(document.querySelectorAll('#projectsGrid .p-card'));

        function norm(s){ return (s || '').toLowerCase().trim(); }

        input?.addEventListener('input', () => {
          const q = norm(input.value);

          cards.forEach(card => {
            const hay = [
              card.getAttribute('data-name'),
              card.getAttribute('data-client'),
              card.getAttribute('data-city'),
            ].join(' ');
            card.style.display = hay.includes(q) ? '' : 'none';
          });
        });
      })();
    </script>
  {% endif %}

</div>
{% endblock %}
